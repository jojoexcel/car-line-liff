<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¬å‹™è»Šå€Ÿç”¨ç³»çµ± - ä¸»é¸å–®</title>
    <script src="./js/version.js"></script> 
    <script src="./js/loader.js"></script>
    <!-- 3. ä½¿ç”¨è¼‰å…¥å™¨å‹•æ…‹è¼‰å…¥æˆ‘å€‘è‡ªå·±çš„ CSS (è‡ªå‹•åŠ ç‰ˆæœ¬è™Ÿ) -->
    <script>
        loadCSS('./css/index.css');
    </script>
  
</head>
<body>
    <div id="loading-overlay"></div>

    <header class="header">
        <h1>å…¬å‹™è»Šå€Ÿç”¨ç³»çµ±</h1>
        <p id="welcome-message">è¼‰å…¥ä¸­...</p>
    </header>

    <main class="nav-menu">
        <!-- ç®¡ç†å“¡æŒ‰éˆ•ï¼Œé è¨­éš±è— -->
        <a id="admin-menu-button" href="admin.html" class="admin-link" style="display: none;">âš™ï¸ ç®¡ç†å“¡åŠŸèƒ½</a>   
        <!-- ä½¿ç”¨è€…æŒ‰éˆ• -->
        <a href="profile.html">ğŸ“ å€‹äººè³‡æ–™</a>
        <a href="booking.html">ğŸ“… é ç´„å€Ÿè»Š</a>
        <a href="action.html">ğŸ”‘ é ˜è»Š / é‚„è»Š</a>
        <a href="status.html">ğŸ” æŸ¥è©¢æˆ‘çš„é ç´„</a>
        <a href="history.html">âœï¸ ä¿®æ”¹æ­·å²è¨˜éŒ„</a>
        <a href="upload.html">ğŸ“· æ‹ç…§ä¸Šå‚³</a>
        <a href="guide.html">â„¹ï¸ ä½¿ç”¨æŒ‡å—</a>
        <a href="#" class="disabled" onclick="event.preventDefault(); alert('æ­¤åŠŸèƒ½å³å°‡æ¨å‡ºï¼');">ğŸ“Š å€‹äººçµ±è¨ˆ</a>
        
        
    </main>
    
    <footer class="footer">
        <p>Â© å°ä¸­å­¸é™¢-å…¬å‹™è»Šç®¡ç†</p>
    </footer>

    <!-- ã€é—œéµã€‘å¼•å…¥å¿…è¦çš„ JS æª”æ¡ˆï¼Œä¸¦åŠ ä¸Šç‰ˆæœ¬è™Ÿ -->
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="./js/main.js?v=1.0.1"></script>
    
    <!-- ã€é—œéµã€‘é€™æ˜¯å±¬æ–¼ index.html æ­£ç¢ºçš„ JavaScript -->
    <script>
        /**
         * ä¸»é¸å–®é é¢çš„åˆå§‹åŒ–å‡½å¼ (æ¬Šé™åˆ¤æ–·ç‰ˆ)
         */
        async function initializeIndexPage() {
            // å¾ main.js å‘¼å« initializeLiffï¼Œå®ƒæœƒè™•ç†è¼‰å…¥é®ç½©
            const liffProfile = await initializeLiff(); 
            
            const welcomeEl = document.getElementById('welcome-message');

            if (!liffProfile) {
                // å¦‚æœåˆå§‹åŒ–å¤±æ•—æˆ–éœ€è¦ç™»å…¥ï¼Œmain.js æœƒè™•ç†ï¼Œé€™è£¡åªé¡¯ç¤ºæœ€çµ‚è¨Šæ¯
                if (welcomeEl) welcomeEl.textContent = 'è¼‰å…¥å¤±æ•—æˆ–éœ€è¦ç™»å…¥';
                return;
            }

            // é¡¯ç¤ºå€‹äººåŒ–çš„æ­¡è¿è¨Šæ¯
            if (welcomeEl) welcomeEl.textContent = `æ­¡è¿ï¼Œ${liffProfile.displayName}`;

            // å‘¼å«å¾Œç«¯ APIï¼Œæª¢æŸ¥ä½¿ç”¨è€…èº«ä»½ï¼Œä»¥æ±ºå®šæ˜¯å¦é¡¯ç¤ºç®¡ç†å“¡æŒ‰éˆ•
            try {
                const result = await callGasApi('getUserProfile', { userId: liffProfile.userId });

                if (result.status === 'found') {
                    const userStatus = result.data.status;
                    
                    // åªæœ‰ã€Œç®¡ç†è€…ã€æˆ–ã€Œé–‹ç™¼è€…ã€æ‰èƒ½çœ‹åˆ°æŒ‰éˆ•
                    if (userStatus === 'ç®¡ç†è€…' || userStatus === 'é–‹ç™¼è€…') {
                        const adminButton = document.getElementById('admin-menu-button');
                        if (adminButton) {
                            adminButton.style.display = 'flex'; // ä½¿ç”¨ flex ä»¥ç¶­æŒæ’ç‰ˆä¸€è‡´
                        }
                    }
                }
            } catch (error) {
                console.error('Failed to get user profile for admin check:', error);
            }
        }
        
        // åŸ·è¡Œåˆå§‹åŒ–
        initializeIndexPage();
    </script>
</body>
</html>
