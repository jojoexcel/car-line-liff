<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¬å‹™è»Šå€Ÿç”¨ç³»çµ± - ä¸»é¸å–®</title>

    <!-- 1. è¼‰å…¥ç‰ˆæœ¬è™Ÿå’Œè¼‰å…¥å™¨ -->
    <script src="./js/version.js"></script>
    <script src="./js/loader.js"></script>

    <!-- 2. å‹•æ…‹è¼‰å…¥ CSS -->
    <script>
        loadCSS('./css/style.css');
    </script>

    <!-- 3. é é¢ç¨æœ‰çš„æ·±è‰²ä¸»é¡Œæ¨£å¼ -->
    <style>
        :root {
            --dark-bg: #1c1c1e; --primary-text: #ffffff; --secondary-text: #8e8e93;
            --accent-color: #34c759; --card-bg: #2c2c2e; --card-border: #3a3a3c;
            --admin-bg: #5856d6; --admin-border: #8e8e93; --admin-text: #ffffff;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--dark-bg); color: var(--primary-text); margin: 0;
            padding: 1.5em; display: flex; flex-direction: column; min-height: calc(100vh - 3em);
        }
        .header { text-align: center; padding-bottom: 20px; margin-bottom: 30px; }
        .header h1 { margin: 0; font-size: 1.8em; color: var(--primary-text); }
        .header p { margin: 8px 0 0; font-size: 1.1em; color: var(--accent-color); font-weight: 500; }
        .nav-menu { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 600px; margin: 0 auto; }
        .nav-menu a {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background-color: var(--card-bg); color: var(--primary-text);
            padding: 20px 10px; text-decoration: none; text-align: center;
            border-radius: 12px; border: 1px solid var(--card-border);
            font-size: 1em; font-weight: 500; transition: background-color 0.2s, transform 0.2s;
            min-height: 70px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .nav-menu a:active { transform: scale(0.96); background-color: #3a3a3c; }
        .nav-menu a.admin-link {
            grid-column: 1 / -1; background-color: var(--admin-bg); border-color: var(--admin-border); color: var(--admin-text);
        }
        .nav-menu a.disabled { background-color: #1c1c1e; color: var(--secondary-text); cursor: not-allowed; border-style: dashed; }
        .nav-menu a.disabled:active { transform: none; }
        .footer { text-align: center; margin-top: auto; padding-top: 30px; font-size: 0.8em; color: var(--secondary-text); }
    </style>
</head>
<body>
    <div id="loading-overlay"></div>

    <header class="header">
        <h1>å…¬å‹™è»Šå€Ÿç”¨ç³»çµ±</h1>
        <p id="welcome-message">è¼‰å…¥ä¸­...</p>
    </header>

    <main class="nav-menu">
        <!-- ç®¡ç†å“¡æŒ‰éˆ•ï¼Œé è¨­éš±è—ï¼Œç”± JS æ±ºå®šæ˜¯å¦é¡¯ç¤º -->
        <a id="admin-menu-button" href="admin.html" class="admin-link" style="display: none;">âš™ï¸ ç®¡ç†å“¡åŠŸèƒ½</a>

        <a href="profile.html">ğŸ“ å€‹äººè³‡æ–™</a>
        <a href="booking.html">ğŸ“… é ç´„å€Ÿè»Š</a>
        <a href="action.html">ğŸ”‘ é ˜è»Š / é‚„è»Š</a>
        <a href="status.html">ğŸ” æŸ¥è©¢æˆ‘çš„é ç´„</a>
        <a href="history.html">âœï¸ ä¿®æ”¹æ­·å²è¨˜éŒ„</a>
        <a href="upload.html">ğŸ“· æ‹ç…§ä¸Šå‚³</a>
        <a href="guide.html">â„¹ï¸ ä½¿ç”¨æŒ‡å—</a>
        <a href="#" class="disabled" onclick="event.preventDefault(); alert('æ­¤åŠŸèƒ½å³å°‡æ¨å‡ºï¼');">ğŸ“Š å€‹äººçµ±è¨ˆ</a>



    </main>

    <footer class="footer">
        <p>Â© å°ä¸­å­¸é™¢-å…¬å‹™è»Šç®¡ç†</p>
    </footer>

    <!-- è¼‰å…¥ JS -->
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
        loadJS(
            ['./js/main.js'], // index.html åªéœ€è¦ main.js
            function() {
                // ç•¶ main.js è¼‰å…¥å®Œæˆå¾Œï¼ŒåŸ·è¡Œåˆå§‹åŒ–
                initializeIndexPage();
            }
        );

        /**
         * index.html é é¢çš„ä¸»åˆå§‹åŒ–å‡½å¼ (æ¬Šé™åˆ¤æ–·ç‰ˆ)
         */
        async function initializeIndexPage() {
            const welcomeEl = document.getElementById('welcome-message');

            // å¾ main.js å‘¼å« initializeLiff
            const liffProfile = await initializeLiff();

            if (!liffProfile) {
                if (welcomeEl) welcomeEl.textContent = 'è¼‰å…¥å¤±æ•—æˆ–éœ€è¦ç™»å…¥';
                return;
            }

            if (welcomeEl) welcomeEl.textContent = `æ­¡è¿ï¼Œ${liffProfile.displayName}`;

            // å‘¼å«å¾Œç«¯ API æª¢æŸ¥ä½¿ç”¨è€…èº«ä»½
            try {
                const result = await callGasApi('getUserProfile', { userId: liffProfile.userId });

                if (result.status === 'found') {
                    const userStatus = result.data.status;
                    if (userStatus === 'ç®¡ç†è€…' || userStatus === 'é–‹ç™¼è€…') {
                        const adminButton = document.getElementById('admin-menu-button');
                        if (adminButton) {
                            adminButton.style.display = 'flex';
                        }
                    }
                }
            } catch (error) {
                console.error('Failed to get user profile for admin check:', error);
            }
        }
    </script>
</body>
</html>