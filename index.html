<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>公務車借用系統 - 主選單</title>
    <link rel="stylesheet" href="./css/index.css">
</head>
<body>
    <!-- 全域載入遮罩，雖然是黑色主題，但 JS 可能會用到 -->
    <div id="loading-overlay"></div>

    <header class="header">
        <h1>公務車借用系統</h1>
        <p id="welcome-message">載入中...</p>
    </header>

    <main class="nav-menu">
        <!-- 已完成的功能 -->
        <a href="guide.html">ℹ️ 使用指南</a>
        <a href="profile.html">📝 個人資料</a>
        <a href="booking.html">📅 預約借車</a>
        <a href="action.html">🔑 領車 / 還車</a>
        <a href="status.html">🔍 查詢我的預約</a>
        <a href="history.html">✍️ 修改歷史記錄</a>
        <a href="upload.html">📷 拍照上傳</a>

        <!-- 尚未製作的功能，加上 'disabled' class -->
        <a href="#" class="disabled" onclick="event.preventDefault(); alert('此功能即將推出！');">📊 個人統計</a>
        <a id="admin-menu-button" href="admin.html" class="admin-link" style="display: none;">⚙️ 管理員功能</a>
    </main>
    
    <footer class="footer">
        <p>© 台中學院-公務車管理</p>
    </footer>

    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="./js/main.js"></script>
    <script>
        // admin.html 專用的 JS
        async function initializeAdminPage() {
            const liffProfile = await initializeLiff();
            if (!liffProfile) return;

            try {
                const result = await callGasApi('getUserProfile', { userId: liffProfile.userId });
                const adminWelcome = document.getElementById('admin-welcome');
                const adminMenu = document.getElementById('admin-menu-container');

                if (result.status === 'found' && (result.data.status === '管理者' || result.data.status === '開發者')) {
                    // 權限驗證通過
                    adminWelcome.textContent = `權限已確認，${result.data.name}。請選擇要執行的操作。`;
                    adminMenu.style.display = 'block';
                } else {
                    // 權限不足
                    adminWelcome.style.color = 'var(--error-color)';
                    adminWelcome.textContent = '權限不足！此頁面僅供管理員使用。';
                }
            } catch (error) {
                document.getElementById('admin-welcome').textContent = '驗證權限時發生錯誤。';
            }
        }
        initializeAdminPage();
    </script>
</body>
</html>
